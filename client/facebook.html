<!DOCTYPE html>
<html>
  <head>
    <title>Facebook Login JavaScript Example</title>
    <meta charset="UTF-8">
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
<body>
  <div class="col-md-4 halo">

  </div>
  <div class="kode">
    <input class='post' type="text" name="post">
  </div>

  <button class='test'  type="button" name="button" onclick="login()">Login with FB</button>
  <button class='post'  type="button" name="button" onclick="post()">Post</button>

<script>


  // This function is called when someone finishes with the Login
  // Button.  See the onlogin handler attached to it in the sample
  // code below.

  window.fbAsyncInit = function() {
  FB.init({
    appId      : 247912815718521,
    cookie     : true,  // enable cookies to allow the server to access
                        // the session
    xfbml      : true,  // parse social plugins on this page
    version    : 'v2.8' // use graph api version 2.8
  });

  // Now that we've initialized the JavaScript SDK, we call
  // FB.getLoginStatus().  This function gets the state of the
  // person visiting this page and can return one of three states to
  // the callback you provide.  They can be:
  //
  // 1. Logged into your app ('connected')
  // 2. Logged into Facebook, but not your app ('not_authorized')
  // 3. Not logged into Facebook and can't tell if they are logged into
  //    your app or not.
  //
  // These three cases are handled in the callback function.


  };

  // Load the SDK asynchronously
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/sdk.js";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));

  // Here we run a very simple test of the Graph API after login is
  // successful.  See statusChangeCallback() for when this call is made.

  function login(){
    FB.login(function(response){
      if(response.authResponse){
        console.log(response);
        console.log('Welcome! Fetching your information');
        localStorage.setItem('fbaccesstoken', response.authResponse.accessToken)
        axios.get('http://localhost:3000/facebook/login', {
          headers:{
            token: response.authResponse.accessToken
          }
        })
        .then(response =>{
          $('.halo').append(`<p>Hai!  ${response.data.name}</p>`);
          $('.kode').append(`<input type="hidden" name="token" class="token" value="${response.data}">`)
          console.log(response);
        })
      }else {
        console.log('user canceled login or dit not fully authorize');
      }
    }, {scope: 'publish_actions,email,public_profile'})
  }

  function post(){
        axios.post('http://localhost:3000/facebook/post', {
            token: localStorage.getItem('fbaccesstoken'),
            pesan: $('.post').val()
        })
        .then(res =>{
          console.log(res);
        })
        .catch(err =>{
          console.log(err);
        })
}

$('.test').click(function(){
  $( ".test" ).fadeOut( "slow", function() {
  // Animation complete.
})
})

</script>

<!--
  Below we include the Login Button social plugin. This button uses
  the JavaScript SDK to present a graphical Login button that triggers
  the FB.login() function when clicked.
-->


</body>
</html>
